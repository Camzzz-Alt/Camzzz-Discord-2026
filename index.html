<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Camzzz's Discord</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href="https://i.imgur.com/ELHSqM3.png" type="image/png">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

  <!-- ========== AUTH SCREEN ========== -->
  <div id="authScreen">
    <div class="auth-bg-grid"></div>

    <!-- LOGIN CARD -->
    <div class="auth-card" id="loginCard">
      <div class="auth-logo">
        <img class="logo-icon-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
        <span>Camzzz's Discord</span>
      </div>
      <h2>Welcome back</h2>
      <p class="auth-subtitle">Sign in to continue chatting</p>
      <button id="googleSignInBtn" class="google-btn">
        <svg width="18" height="18" viewBox="0 0 18 18">
          <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/>
          <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
          <path fill="#FBBC05" d="M3.964 10.71c-.18-.54-.282-1.117-.282-1.71s.102-1.17.282-1.71V4.958H.957C.347 6.173 0 7.548 0 9s.348 2.827.957 4.042l3.007-2.332z"/>
          <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
        </svg>
        Continue with Google
      </button>
      <div class="auth-divider"><span>or</span></div>
      <div class="auth-field">
        <label>Email</label>
        <input id="loginEmail" type="email" placeholder="you@example.com" autocomplete="email">
      </div>
      <div class="auth-field">
        <label>Password</label>
        <input id="loginPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
      </div>
      <p id="loginError" class="auth-error"></p>
      <button id="loginBtn" class="auth-btn">Sign In</button>
      <p class="auth-switch">No account? <a id="showSignupBtn" href="#">Create one</a></p>
      <p id="verifyNotice" class="verify-notice" style="display:none;">
        üìß Please verify your email first. <a id="resendVerifyBtn" href="#">Resend email</a>
      </p>
    </div>

    <!-- SIGNUP CARD -->
    <div class="auth-card" id="signupCard" style="display:none;">
      <div class="auth-logo">
        <img class="logo-icon-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
        <span>Camzzz's Discord</span>
      </div>
      <h2>Create account</h2>
      <p class="auth-subtitle">Join the server ‚Äî it's invite-only</p>
      <button id="googleSignUpBtn" class="google-btn">
        <svg width="18" height="18" viewBox="0 0 18 18">
          <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/>
          <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
          <path fill="#FBBC05" d="M3.964 10.71c-.18-.54-.282-1.117-.282-1.71s.102-1.17.282-1.71V4.958H.957C.347 6.173 0 7.548 0 9s.348 2.827.957 4.042l3.007-2.332z"/>
          <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
        </svg>
        Sign up with Google
      </button>
      <div class="auth-divider"><span>or</span></div>
      <div class="auth-field">
        <label>Username</label>
        <input id="signupUsername" type="text" placeholder="CoolUsername" maxlength="24">
        <span id="usernameCheck" class="field-hint"></span>
      </div>
      <div class="auth-field">
        <label>Email</label>
        <input id="signupEmail" type="email" placeholder="you@example.com" autocomplete="email">
      </div>
      <div class="auth-field">
        <label>Password</label>
        <input id="signupPassword" type="password" placeholder="At least 6 characters" autocomplete="new-password">
      </div>
      <p id="signupError" class="auth-error"></p>
      <button id="signupBtn" class="auth-btn">Create Account</button>
      <p class="auth-switch">Already have one? <a id="showLoginBtn" href="#">Sign in</a></p>
    </div>

    <!-- GOOGLE USERNAME PICKER (new Google users only) -->
    <div class="auth-card" id="googleUsernameCard" style="display:none;">
      <div class="auth-logo">
        <img class="logo-icon-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
        <span>Camzzz's Discord</span>
      </div>
      <h2>Pick a username</h2>
      <p class="auth-subtitle">How you'll appear in chat. You can change it once per week.</p>
      <div class="auth-field">
        <label>Username</label>
        <input id="googleUsername" type="text" placeholder="CoolUsername" maxlength="24">
        <span id="googleUsernameCheck" class="field-hint"></span>
      </div>
      <p id="googleUsernameError" class="auth-error"></p>
      <button id="googleUsernameConfirmBtn" class="auth-btn">Let's go ‚Üí</button>
    </div>

    <!-- VERIFY EMAIL CARD -->
    <div class="auth-card" id="verifyCard" style="display:none;">
      <div class="auth-logo">
        <img class="logo-icon-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
        <span>Camzzz's Discord</span>
      </div>
      <h2>Check your email</h2>
      <p class="auth-subtitle">We sent a verification link to <strong id="verifyEmailAddr"></strong>. Click it to activate your account.</p>
      <button id="resendVerifyBtn2" class="auth-btn" style="margin-top:8px;">Resend Email</button>
      <p class="auth-switch"><a id="backToLoginBtn" href="#">‚Üê Back to sign in</a></p>
    </div>
  </div>

  <!-- ========== MOD MENU PASSWORD GATE ========== -->
  <div id="modMenuPasswordGate" style="display:none;">
    <div class="gateCard">
      <div class="gateLogo">üõ°Ô∏è Mod Access</div>
      <h2>Moderator Login</h2>
      <p class="gateSubtitle">Enter the mod password to access admin controls.</p>
      <div class="inputRow">
        <input id="modMenuPasswordInput" type="password" placeholder="Mod password" autocomplete="off">
        <button id="modMenuEnterBtn">Enter</button>
      </div>
      <p id="modMenuGateMessage" class="gateMessage"></p>
    </div>
  </div>

  <!-- ========== MOD MENU ========== -->
  <div id="modMenu" style="display:none;">
    <div class="modMenuContainer">
      <div class="modMenuHeader">
        <div class="modMenuHeaderLeft">
          <span class="modMenuIcon">üõ°Ô∏è</span>
          <div>
            <h2>Moderator Panel</h2>
            <p class="modMenuSubtitle">Moderation controls</p>
          </div>
        </div>
        <button id="modMenuCloseBtn">‚úï Close</button>
      </div>
      <div class="modSearchBar">
        <span class="modSearchIcon">üîç</span>
        <input id="modSearchInput" type="text" placeholder="Search users..." autocomplete="off">
      </div>
      <div class="modTabBar">
        <button class="modTab active" data-tab="modUsers">üë• Users <span class="modTabBadge" id="modUsersTabBadge">0</span></button>
        <button class="modTab" data-tab="modTags">üè∑Ô∏è Tags</button>
        <button class="modTab" data-tab="modTimeouts">‚è±Ô∏è Timeouts</button>
        <button class="modTab" data-tab="modTagViewer">üîé Tag Viewer</button>
      </div>
      <div class="modTabContent active" id="tabModUsers"><div id="modUsersList"></div></div>
      <div class="modTabContent" id="tabModTags">
        <div class="modSectionInner">
          <label class="modLabel">SELECT TAG</label>
          <div class="tagPalette" id="modTagPalette"></div>
          <label class="modLabel" style="margin-top:12px;">USER ID</label>
          <div class="inputRow">
            <input id="modTagUserIdInput" class="mod-input-full" placeholder="User ID">
            <input id="modTagNameInput" class="mod-input-full" placeholder="Tag name" style="max-width:140px;" readonly>
            <button class="mod-action-btn" id="modAddTagBtn">+ Add Tag</button>
          </div>
        </div>
        <div class="modSectionInner"><div id="modTaggedUsersList"></div></div>
      </div>
      <div class="modTabContent" id="tabModTimeouts">
        <div class="modSectionInner">
          <label class="modLabel">TIMEOUT USER</label>
          <input id="modTimeoutUserIdInput" class="mod-input-full" placeholder="User ID" style="margin-bottom:10px;">
          <label class="modLabel">DURATION</label>
          <div class="timeoutDurationGrid">
            <button class="timeoutDurBtn mod-dur" data-ms="300000">5 min</button>
            <button class="timeoutDurBtn mod-dur" data-ms="600000">10 min</button>
            <button class="timeoutDurBtn mod-dur" data-ms="1800000">30 min</button>
            <button class="timeoutDurBtn mod-dur" data-ms="3600000">1 hour</button>
            <button class="timeoutDurBtn mod-dur" data-ms="86400000">1 day</button>
            <button class="timeoutDurBtn mod-dur" data-ms="604800000">1 week</button>
          </div>
          <button class="mod-action-btn" id="modApplyTimeoutBtn" style="margin-top:10px;width:100%;">‚è±Ô∏è Apply Timeout</button>
        </div>
        <div class="modSectionInner"><div id="modActiveTimeoutsList"></div></div>
      </div>
      <!-- NEW: Tag Viewer tab for mod menu -->
      <div class="modTabContent" id="tabModTagViewer">
        <div class="modSectionInner" style="padding-bottom:0;">
          <label class="modLabel">ALL TAGS & THEIR USERS</label>
        </div>
        <div style="padding:0 16px 16px;" id="modTagViewerList"></div>
      </div>
    </div>
  </div>

  <!-- ========== CONFIRM DIALOG ========== -->
  <div id="modConfirmDialog" style="display:none;">
    <div class="confirmCard">
      <div class="confirmIcon" id="confirmIcon">‚ö†Ô∏è</div>
      <h3 id="confirmTitle">Are you sure?</h3>
      <p id="confirmMessage">This action cannot be undone.</p>
      <div class="confirmBtns">
        <button id="confirmCancelBtn" class="confirmBtn cancel">Cancel</button>
        <button id="confirmOkBtn" class="confirmBtn ok">Confirm</button>
      </div>
    </div>
  </div>

  <!-- ========== LOADING SCREEN ========== -->
  <div id="loadingScreen" style="display:none;">
    <div class="loading-content">
      <img class="loading-logo-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
      <h2>Loading Chat...</h2>
      <div id="countdownContainer"><div id="countdownBar"></div></div>
      <p id="countdownText">3s</p>
    </div>
  </div>

  <!-- ========== MAIN APP ========== -->
  <div id="appContainer" style="display:none;">

    <!-- SIDEBAR -->
    <div id="sidebar">
      <div class="sidebar-top">
        <div class="sidebar-brand">
          <img class="sidebar-logo-img" src="https://i.imgur.com/ELHSqM3.png" alt="Logo">
          <span>Camzzz's Discord</span>
        </div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-section-label">CHANNELS</div>
        <button class="serverBtn" data-server="server1"><span class="channel-hash">#</span><span class="channel-label">general</span><span class="unread-dot" id="unread-server1" style="display:none;"></span></button>
        <button class="serverBtn" data-server="server2"><span class="channel-hash">#</span><span class="channel-label">general-2</span><span class="unread-dot" id="unread-server2" style="display:none;"></span></button>
        <div id="privateChannelBtn"></div>
        <div id="modChatBtn"></div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-section-label">APPEARANCE</div>
        <div id="colorPickerBtn"></div>
        <div id="themeColorSection"></div>
        <div id="textSizeSection"></div>
      </div>
      <div id="sidebarTagsSection" class="sidebar-section" style="padding-top:8px;padding-bottom:8px;"></div>
      <div class="online-count-display">
        <span class="online-dot"></span>
        <span id="onlineCountNum">0</span>&nbsp;online
      </div>
      <div class="sidebar-user-panel">
        <div class="user-avatar-wrap" id="sidebarAvatarWrap">
          <div class="user-avatar" id="sidebarAvatar">?</div>
        </div>
        <input type="file" id="avatarFileInput" accept="image/*" style="display:none;">
        <div class="user-info">
          <div id="sidebarUsername" class="user-name">Loading...</div>
          <div class="user-status" id="sidebarUserTags"></div>
        </div>
        <button id="logoutBtn" class="logout-btn" title="Sign out">‚èª</button>
      </div>
    </div>

    <!-- CHAT -->
    <div id="chatContainer">
      <div id="chatHeader">
        <span class="channel-hash" style="font-size:18px;">#</span>
        <span id="channelName">general</span>
        <div id="betaWarning">‚ö† Beta ‚Äî messages may lag. Click to dismiss.</div>
      </div>
      <div id="chatbox"></div>
      <button id="scrollToBottomBtn" class="scroll-to-bottom" style="display:none;">‚Üì New messages</button>

      <!-- TYPING INDICATOR ‚Äî now inside a fixed overlay above the input, not pushing layout -->
      <div id="typingIndicatorWrap">
        <div id="typingIndicator" class="typing-indicator" style="display:none;">
          <div class="typing-dots"><span></span><span></span><span></span></div>
          <span id="typingText"></span>
        </div>
      </div>

      <div id="replyBar" style="display:none;">
        <div class="reply-bar-inner">
          <span class="reply-bar-label">‚Ü© Replying to <span id="replyToName"></span></span>
          <span class="reply-bar-preview" id="replyToPreview"></span>
          <button id="cancelReplyBtn">‚úï</button>
        </div>
      </div>
      <div id="usernameChangeBar" style="display:none;">
        <div class="username-change-inner">
          <input id="usernameChangeInput" placeholder="New username" maxlength="24">
          <span id="usernameChangeCooldown" class="cooldown-hint"></span>
          <button id="usernameChangeSaveBtn">Save</button>
          <button id="usernameChangeCancelBtn">Cancel</button>
        </div>
      </div>
      <div style="position:relative;">
        <div id="mentionDropdown" class="mention-dropdown" style="display:none;"></div>
        <div id="inputArea">
          <button id="changeUsernameBtn" class="input-icon-btn" title="Change username">‚úèÔ∏è</button>
          <input id="msgInput" placeholder="Message #general">
          <button id="sendBtn">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN PASSWORD GATE -->
  <div id="adminMenuPasswordGate" style="display:none;">
    <div class="gateCard">
      <div class="gateLogo">ADMIN</div>
      <h2>Admin Panel</h2>
      <p class="gateSubtitle">Enter the admin password to continue.</p>
      <div class="inputRow">
        <input id="adminMenuPasswordInput" type="password" placeholder="Password" autocomplete="off">
        <button id="adminMenuEnterBtn">Enter</button>
      </div>
      <p id="adminMenuGateMessage" class="gateMessage"></p>
    </div>
  </div>

  <!-- ADMIN MENU -->
  <div id="adminMenu" style="display:none;">
    <div class="modMenuContainer wide">
      <div class="modMenuHeader">
        <div class="modMenuHeaderLeft">
          <span class="modMenuIcon">üëë</span>
          <div>
            <h2>Admin Panel</h2>
            <p class="modMenuSubtitle">Full server administration</p>
          </div>
        </div>
        <button id="adminMenuCloseBtn">‚úï Close</button>
      </div>
      <div class="modSearchBar">
        <span class="modSearchIcon">üîç</span>
        <input id="adminSearchInput" placeholder="Search users...">
      </div>
      <div class="modTabBar">
        <button class="modTab active" data-tab="adminUsers">üë• Users <span class="modTabBadge" id="adminUsersTabBadge">0</span></button>
        <button class="modTab" data-tab="adminBans">üö´ Bans <span class="modTabBadge" id="adminBansTabBadge">0</span></button>
        <button class="modTab" data-tab="adminTags">üè∑Ô∏è Tags</button>
        <button class="modTab" data-tab="adminTimeouts">‚è±Ô∏è Timeouts <span class="modTabBadge" id="adminTimeoutsTabBadge">0</span></button>
        <button class="modTab" data-tab="adminCreateTag">‚ú® Create Tag</button>
        <button class="modTab" data-tab="adminTagViewer">üîé Tag Viewer</button>
        <button class="modTab" data-tab="adminLogs">üìã Logs <span class="modTabBadge" id="adminLogsTabBadge">0</span></button>
      </div>
      <div class="modTabContent active" id="tabAdminUsers"><div id="adminUsersList"></div></div>
      <div class="modTabContent" id="tabAdminBans">
        <div class="modSectionInner">
          <label class="modLabel">BAN BY USER ID</label>
          <div class="inputRow">
            <input id="adminBanUserInput" class="mod-input-full" placeholder="User ID">
            <button class="mod-action-btn danger" id="adminBanUserBtn">üö´ Ban</button>
          </div>
        </div>
        <div class="modSectionInner"><div id="adminBannedList"></div></div>
      </div>
      <div class="modTabContent" id="tabAdminTags">
        <div class="modSectionInner">
          <label class="modLabel">SELECT TAG</label>
          <div class="tagPalette" id="adminTagPalette"></div>
          <label class="modLabel" style="margin-top:12px;">USER ID</label>
          <div class="inputRow">
            <input id="adminTagUserIdInput" class="mod-input-full" placeholder="User ID">
            <input id="adminTagNameInput" class="mod-input-full" placeholder="Tag name" style="max-width:140px;" readonly>
            <button class="mod-action-btn" id="adminAddTagBtn">+ Add Tag</button>
          </div>
        </div>
        <div class="modSectionInner"><div id="adminTaggedUsersList"></div></div>
      </div>
      <div class="modTabContent" id="tabAdminTimeouts">
        <div class="modSectionInner">
          <label class="modLabel">TIMEOUT USER</label>
          <input id="adminTimeoutUserIdInput" class="mod-input-full" placeholder="User ID" style="margin-bottom:10px;">
          <label class="modLabel">DURATION</label>
          <div class="timeoutDurationGrid">
            <button class="timeoutDurBtn admin-dur" data-ms="300000">5 min</button>
            <button class="timeoutDurBtn admin-dur" data-ms="600000">10 min</button>
            <button class="timeoutDurBtn admin-dur" data-ms="1800000">30 min</button>
            <button class="timeoutDurBtn admin-dur" data-ms="3600000">1 hour</button>
            <button class="timeoutDurBtn admin-dur" data-ms="86400000">1 day</button>
            <button class="timeoutDurBtn admin-dur" data-ms="604800000">1 week</button>
          </div>
          <button class="mod-action-btn" id="adminApplyTimeoutBtn" style="margin-top:10px;width:100%;">‚è±Ô∏è Apply Timeout</button>
        </div>
        <div class="modSectionInner"><div id="adminActiveTimeoutsList"></div></div>
      </div>
      <div class="modTabContent" id="tabAdminCreateTag">
        <div class="modSectionInner">
          <label class="modLabel">NEW TAG NAME</label>
          <input id="newTagName" class="mod-input-full" placeholder="Tag name" maxlength="24" style="margin-bottom:10px;">
          <label class="modLabel">TAG COLOR</label>
          <div class="inputRow" style="margin-bottom:12px;">
            <input type="color" id="newTagColor" class="color-picker-input" value="#5865f2">
            <div class="tag-preview-wrap"><span class="tag-preview-text" id="newTagPreviewLabel">[Preview]</span></div>
          </div>
          <button class="mod-action-btn" id="createTagBtn" style="width:100%;">‚ú® Create Tag</button>
          <p class="create-tag-msg" id="createTagMsg"></p>
        </div>
        <div class="modSectionInner">
          <label class="modLabel">EXISTING CUSTOM TAGS</label>
          <div id="customTagsList"></div>
        </div>
      </div>
      <!-- NEW: Tag Viewer tab for admin menu -->
      <div class="modTabContent" id="tabAdminTagViewer">
        <div class="modSectionInner" style="padding-bottom:0;">
          <label class="modLabel">ALL TAGS & THEIR USERS</label>
        </div>
        <div style="padding:0 16px 16px;" id="adminTagViewerList"></div>
      </div>
      <div class="modTabContent" id="tabAdminLogs">
        <div id="modActionLogList"></div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
